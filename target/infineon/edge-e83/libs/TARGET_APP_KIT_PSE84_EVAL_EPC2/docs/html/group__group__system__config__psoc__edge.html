<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>KIT_PSE84_EVAL_EPC2 BSP</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="logo.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">KIT_PSE84_EVAL_EPC2 BSP</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;"
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group__group__system__config__psoc__edge.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0"
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">API Reference</a>  </div>
  <div class="headertitle"><div class="title">Startup/System</div></div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">General Description</h2>
<p >Provides device startup, system configuration, and linker script files. </p>
<p >The system startup provides the followings features:</p><ul>
<li><a class="el" href="group__group__system__config__psoc__edge.html#group_system_config_device_memory_definition_edge">Device Memory Definition</a></li>
<li><a class="el" href="group__group__system__config__psoc__edge.html#group_system_config_device_initialization_edge">Device Initialization</a></li>
<li><a class="el" href="group__group__system__config__psoc__edge.html#group_system_config_heap_stack_config_edge">Heap and Stack Configuration</a></li>
<li><a class="el" href="group__group__system__config__psoc__edge.html#group_system_config_default_handlers_edge">Default Interrupt Handlers Definition</a></li>
<li><a class="el" href="group__group__system__config__psoc__edge.html#group_system_config_device_vector_table_edge">Vectors Table Copy from Flash to RAM</a></li>
</ul>
<h1><a class="anchor" id="group_system_config_configuration_edge"></a>
Configuration Considerations</h1>
<h2><a class="anchor" id="group_system_config_device_memory_definition_edge"></a>
Device Memory Definition</h2>
<p >Allocation of different types of memory such as the RRAM and RAM etc. for the CPU is defined by the linker scripts.</p>
<dl class="section note"><dt>Note</dt><dd>The linker files provided with the templates are generic and handle all common use cases. Your project may not use every section defined in the linker files. In that case you may see warnings during the build process. To eliminate build warnings in your project, you can simply comment out or remove the relevant section in the linker file.</dd>
<dd>
If the start of the Cortex-M33 non-secure application image is changed, the value of the <a class="el" href="group__group__system__config__user__settings__macro__edge.html#ga3399608d4a92cfd16a7eca4d9636c616">CY_CORTEX_M33_NS_APPL_ADDR</a> should also be changed. The <a class="el" href="group__group__system__config__user__settings__macro__edge.html#ga3399608d4a92cfd16a7eca4d9636c616">CY_CORTEX_M33_NS_APPL_ADDR</a> macro should be used as the parameter fo the __TZ_set_MSP_NS function call.</dd>
<dd>
If the start of the Cortex-M55 application image is changed, the value of the <a class="el" href="group__group__system__config__user__settings__macro__edge.html#ga02de510de4ee1e844aa544b0db2c5b90">CY_CORTEX_M55_APPL_ADDR</a> should also be changed. The <a class="el" href="group__group__system__config__user__settings__macro__edge.html#ga02de510de4ee1e844aa544b0db2c5b90">CY_CORTEX_M55_APPL_ADDR</a> macro should be used as the parameter for the <a class="el" href="group__group__system__config__cm55__functions__edge.html#gaaee957e11ebb7961c2a80a7fc8785f95" title="Sets vector table base address and enables the Cortex-M55 core and its debug port policy.">Cy_SysCM55Enable()</a> function call.</dd></dl>
<h2><a class="anchor" id="group_system_config_device_initialization_edge"></a>
Device Initialization</h2>
<p >After a power-on-reset (POR), the boot process is handled by the boot code from the on-chip ROM that is always executed by the Cortex-M0+ core. The boot code passes the control to the Cortex-M33 startup code and Cortex-M33 boots the Cortex-M55 core.</p>
<p ><b>CM33 Boot</b><br  />
 CM33 always boots in secure mode after reset. Then, the secure code switches execution to non-secure mode. Each execution environment has its own application image. Each application image contains its startup code. So, there are two separate startup codes. One is for secure execution environment, part of secure application image and other one is for non-secure execution environment, part of non-secure application image. Execution of startup code is triggered by the secure code after it completes the initialization during boot process. It switches control to non-secure startup code by switching processor execution state to non-secure state.<br  />
The secure code is programmed in RRAM NVM MAIN region. This code executes in place (XIP) from RRAM. First secure code to execute on CM33 is CM33_L1_BOOTLOADER. The CM33_L1_BOOTLOADER, SE_RRAM_BOOT code is launched by the code executing on CM0P core in secure enclave by setting the address of the image entry point in the CM33_S_VECTOR_TABLE_BASE (S_VTOR) register and setting the CM33_CTL.CPUWAIT to LOW to allow execution of reset handler of secure image. Address of CM33_L1_BOOTLOADER image entry point is obtained from the TOC2 table entry CM33_L1_BOOTLOADER_ADDR.</p>
<p ><b>CM55 Boot</b><br  />
 The CM55 CPUSS is OFF by default upon POR. CM55 application is launched from CM33 non-secure application depending on the use case requirements. CM55 Application is programmed executed in place from the external flash. The C runtime code will copy necessary code to SOCMEM and other memory areas depending on the choice made for the execution region in the linker script. CM55 execution is held by its CM55_CTL.CPU_WAIT (which will be HIGH) till released (made LOW) by CM33 app to launch the CM55 code after programming the CM55 VTOR with the image entry point in the targeted memory.</p>
<p >Below sequence diagram captures the initialization process in the startup code. <img src="cm33_bootup_sequence.png" alt="" class="inline"/></p>
<h2><a class="anchor" id="group_system_config_heap_stack_config_edge"></a>
Heap and Stack Configuration</h2>
<p >By default, the stack size is set to 0x00001000 for non-secure applications and 0x00000800 for the CM33 secure application. The remaining ram is used for the heap</p>
<h3><a class="anchor" id="group_system_config_heap_stack_config_gcc_edge"></a>
ARM GCC</h3>
<p >The stack and heap sizes are defined in the linker script file: 'pse84_s_cm33.ld', 'pse84_ns_cm33.ld' and 'pse84_ns_cm55.ld' To set stack size in application add makefile ldflags: -Wl,&ndash;defsym=APP_MSP_STACK_SIZE=&lt; CUSTOM_VALUE &gt; Remaining free RAM is used as heap.</p>
<dl class="section note"><dt>Note</dt><dd>Correct operation of malloc and related functions depends on the working implementation of the 'sbrk' function. Newlib-nano (default C runtime library used by the GNU Arm Embedded toolchain) provides weak 'sbrk' implementation that doesn't check for heap and stack collisions during excessive memory allocations. To ensure the heap always remains within the range defined by __HeapBase and __HeapLimit linker symbols, provide a strong override for the 'sbrk' function: <div class="fragment"><div class="line"><span class="keywordtype">void</span> * _sbrk(uint32_t incr)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">extern</span> uint8_t __HeapBase, __HeapLimit;</div>
<div class="line">    <span class="keyword">static</span> uint8_t *heapBrk = &amp;__HeapBase;</div>
<div class="line">    uint8_t *prevBrk = heapBrk;</div>
<div class="line">    <span class="keywordflow">if</span> (incr &gt; (uint32_t)(&amp;__HeapLimit - heapBrk))</div>
<div class="line">    {</div>
<div class="line">        errno = ENOMEM;</div>
<div class="line">        CY_HALT();</div>
<div class="line">    }</div>
<div class="line">    heapBrk += incr;</div>
<div class="line">    <span class="keywordflow">return</span> prevBrk;</div>
<div class="line">}</div>
</div><!-- fragment --> For FreeRTOS-enabled multi-threaded applications, it is sufficient to include clib-support library that provides newlib-compatible implementations of 'sbrk', '__malloc_lock' and '__malloc_unlock': <br  />
 <a href="https://github.com/Infineon/clib-support">https://github.com/Infineon/clib-support</a>.</dd></dl>
<h3><a class="anchor" id="group_system_config_heap_stack_config_arm_edge"></a>
ARM Compiler</h3>
<p >The stack and heap sizes are defined in the linker script file: 'pse84_s_cm33.sct', 'pse84_ns_cm33.sct' and 'pse84_ns_cm55.sct' To set stack size in application add makefile ldflags: &ndash;predefine="-DAPP_MSP_STACK_SIZE=&lt; CUSTOM_VALUE &gt;" Remaining free RAM is used as heap.</p>
<h3><a class="anchor" id="group_system_config_heap_stack_config_iar_edge"></a>
IAR</h3>
<p >The stack and heap sizes are defined in the linker script file: 'pse84_s_cm33.icf', 'pse84_ns_cm33.icf' and 'pse84_ns_cm55.icf' To set stack size in application add makefile ldflags: &ndash;config_def APP_MSP_STACK_SIZE=&lt; CUSTOM_VALUE &gt; Remaining free RAM is used as heap.</p>
<h3><a class="anchor" id="group_system_config_heap_stack_config_llvm_edge"></a>
LLVM ARM</h3>
<p >The stack and heap sizes are defined in the linker script file: 'pse84_s_cm33.ld', 'pse84_ns_cm33.ld' and 'pse84_ns_cm55.ld' To set stack size in application add makefile ldflags: -Wl,&ndash;defsym=APP_MSP_STACK_SIZE=&lt; CUSTOM_VALUE &gt; Remaining free RAM is used as heap.</p>
<h2><a class="anchor" id="group_system_config_default_handlers_edge"></a>
Default Interrupt Handlers Definition</h2>
<p >The default interrupt handler functions are dummy handler in the startup file.<br  />
Below is the default handler for the non-secure interrupts:<br  />
</p><div class="fragment"><div class="line"> interrupt_type <span class="keywordtype">void</span> InterruptHandler(<span class="keywordtype">void</span>) {</div>
<div class="line">   <span class="keywordflow">while</span>(1);</div>
<div class="line">} </div>
</div><!-- fragment --><h2><a class="anchor" id="group_system_config_device_vector_table_edge"></a>
Vectors Table Copy from Flash to RAM</h2>
<p >This process uses memory sections defined in the linker script. The startup code copies the default vector table contents to the non-secure SRAM region specified by the linker script. APIs are provided in the sysint driver to hook user implemented handler replacing the default handler for the corresponding interrupt.</p>
<p >Following tables provide the address of the default and non-secure SRAM interrupt vector table for different supported compilers. The linker script file is 'pse84_ns_cm33.ld'. For non-secure world, it uses the following variable.<br  />
 Copy interrupt vectors from ROM/flash to RAM: <br  />
 From: </p><div class="fragment"><div class="line">__ns_vector_table </div>
</div><!-- fragment --><p> To: </p><div class="fragment"><div class="line">__ns_vector_table_rw </div>
</div><!-- fragment --><p> The vector table address (and the vector table itself) are defined in the ns_start_&lt;device&gt;.c startup file corresponding to non-secure world. The code in these files copies the vector table from Flash to RAM. </p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="groups" name="groups"></a>
API Reference</h2></td></tr>
<tr class="memitem:group__group__system__config__macro__edge"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__system__config__macro__edge.html">Macros</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__system__config__enum__edge"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__system__config__enum__edge.html">Enumerated Types</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__system__config__functions__edge"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__system__config__functions__edge.html">Functions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__system__config__globals__edge"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__system__config__globals__edge.html">Global Variables</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>KIT_PSE84_EVAL_EPC2 BSP</b> by <b>Cypress Semiconductor Corporation</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
