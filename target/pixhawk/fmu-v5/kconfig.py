from SCons.Script import *
import menuconfig
import kconfiglib

AddOption('--fmtconfig',
            dest = 'fmtconfig',
            action = 'store_true',
            default = False,
            help = 'Python GUI menuconfig for FMT')

if GetOption('fmtconfig'):  
    if os.path.exists('.config'):  
        fmtconfig = kconfiglib.Kconfig()
        fmtconfig.load_config(filename = '.config')
        menuconfig.menuconfig(fmtconfig)
        exit(0)
    else:
        fmtconfig = kconfiglib.Kconfig(filename="Kconfig", warn=False)
        menuconfig.menuconfig(fmtconfig)
        exit(0)

INS_SRC = 'ins/base_ins'
import os.path
if os.path.exists('.config'):
    fmtconfig = kconfiglib.Kconfig()
    fmtconfig.load_config(filename = '.config',replace = True)     
    fmtconfig.config_prefix = ''  
    fmtconfig.write_autoconf(filename='autoconfig.h', header = '/* Do not modify this file. It is automatically generated by python scripts */\r\n')
    INS_MODE_BASE_INS = kconfiglib.expr_value(fmtconfig.syms["FMT_USING_BASE_INS"])
    INS_MODE_PX4_ECL = kconfiglib.expr_value(fmtconfig.syms["FMT_USING_PX4_ECL"])
    COMPILE_IN_DEBUG = kconfiglib.expr_value(fmtconfig.syms["FMT_COMPILE_DEBUG"])
    if COMPILE_IN_DEBUG == 0 :
        BUILD = 'release'
    else:
        BUILD = 'debug'
    if INS_MODE_BASE_INS == 2 :
        INS_SRC = 'ins/base_ins'
    if INS_MODE_PX4_ECL == 2 :
        INS_SRC = 'ins/px4_ecl'
    

